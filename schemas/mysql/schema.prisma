// This is your Prisma schema file for MySQL,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                  Int                  @id @default(autoincrement())
  name                String?
  pricingPackageId    String
  settings            Json?
  paidPeriodStart     DateTime?
  paidPeriodEnd       DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  trialEndsAt         DateTime?
  trialStartedAt      DateTime?
  ownerId             Int                  @unique(map: "Organization_ownerId_unique_key") @default(0)
  owner               User                 @relation("OrganizationOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  pricingPackage      PricingPackage       @relation(fields: [pricingPackageId], references: [id])
  apiKeys             ApiKey[]
  packagePayments     PackagePayment[]
  users               User[]               @relation("OrganizationMembers")

  // Strategic Planning Relations
  masterPlans         MasterPlan[]
  organizationalUnits OrganizationalUnit[]

  @@index([pricingPackageId], map: "Organization_pricingPackageId_fkey")
  @@map("organizations")
}

model Feature {
  id                        String                @id @default(uuid())
  name                      String                @unique
  unit                      String?
  description               String?
  timeframe                 Timeframe?            @default(MONTHLY)
  count                     Boolean?
  on_off                    Boolean?
  non_crud                  Int?
  non_crud_feature_set_name String?
  isSystemFeature           Boolean               @default(false)
  pricingPackageFeatures    PricingPackageFeature[]
  @@map("features")
}

model PackagePayment {
  id               String         @id @default(uuid())
  organizationId   Int
  pricingPackageId String
  amount           Int
  paymentStatus    PaymentStatus  @default(PENDING)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  organization     Organization   @relation(fields: [organizationId], references: [id])
  pricingPackage   PricingPackage @relation(fields: [pricingPackageId], references: [id])
  @@index([organizationId], map: "package_payments_organizationId_fkey")
  @@index([pricingPackageId], map: "package_payments_pricingPackageId_fkey")
  @@map("package_payments")
}

model PricingPackage {
  id                              String                  @id @default(uuid())
  name                            String                  @unique
  priceMonthly                    Int?
  priceYearly                     Int?
  isStandard                      Boolean?                @default(false)
  pricingTableLabel               String?
  yearlyPriceDiscountPercentage   Decimal?
  organizations                   Organization[]
  packagePayments                 PackagePayment[]
  features                        PricingPackageFeature[]
  @@map("pricing_packages")
}

model PricingPackageFeature {
  id               String         @id @default(uuid())
  pricingPackageId String
  featureId        String
  limitValue       Int?
  status           Boolean        @default(true)
  seats            Int?
  feature          Feature        @relation(fields: [featureId], references: [id], onDelete: Cascade)
  pricingPackage   PricingPackage @relation(fields: [pricingPackageId], references: [id], onDelete: Cascade)

  @@unique([pricingPackageId, featureId])
  @@index([featureId], map: "pricing_package_features_featureId_fkey")
  @@map("pricing_package_features")
}

model Metering {
  id               String   @id @default(uuid())
  organizationId   Int
  featureName      String
  action           String
  metadata         Json?
  createdAt        DateTime @default(now())
  @@map("meterings")
}

model ApiKey {
  id             String       @id @default(uuid())
  organizationId Int
  keyPrefix      String       @unique
  hashedKey      String
  permissions    Json?
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId], map: "api_keys_organizationId_fkey")
  @@map("api_keys")
}


enum MeterType {
  COUNT
  ON_OFF
}

enum Timeframe {
  MONTHLY
  YEARLY
  FOREVER
}